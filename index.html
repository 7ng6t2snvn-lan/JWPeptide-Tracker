<!DOCTYPE html>
<html lang="en">
<head>
<script>
  if (!location.pathname.endsWith('/')) {
    location.replace(location.pathname + '/');
  }
</script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0B1120">
  <title>Shot Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root {
      --bg-primary: #0B1120; --bg-secondary: #131C2E; --bg-card: #1A2538; --bg-card-hover: #212F45;
      --accent-cyan: #22D3EE; --accent-teal: #14B8A6; --accent-green: #10B981;
      --accent-orange: #F59E0B; --accent-red: #EF4444; --accent-purple: #A78BFA; --accent-pink: #F472B6;
      --text-primary: #F1F5F9; --text-secondary: #94A3B8; --text-muted: #64748B; --border-color: #2D3B4F;
    }
    body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }
    #root { min-height: 100vh; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    
    .pin-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; background: linear-gradient(135deg, var(--bg-primary) 0%, #0F172A 100%); }
    .pin-logo { font-size: 48px; margin-bottom: 16px; }
    .pin-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .pin-subtitle { font-size: 14px; color: var(--text-secondary); margin-bottom: 32px; }
    .pin-dots { display: flex; gap: 16px; margin-bottom: 32px; }
    .pin-dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid var(--accent-cyan); background: transparent; transition: all 0.2s; }
    .pin-dot.filled { background: var(--accent-cyan); box-shadow: 0 0 12px rgba(34, 211, 238, 0.5); }
    .pin-dot.error { border-color: var(--accent-red); background: var(--accent-red); animation: shake 0.4s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
    .pin-keypad { display: grid; grid-template-columns: repeat(3, 72px); gap: 16px; }
    .pin-key { width: 72px; height: 72px; border-radius: 50%; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 28px; font-weight: 600; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: center; }
    .pin-key:hover { background: var(--bg-card-hover); border-color: var(--accent-cyan); }
    .pin-key:active { transform: scale(0.95); background: var(--accent-cyan); color: var(--bg-primary); }
    .pin-key.empty { visibility: hidden; }
    
    .app-container { max-width: 430px; margin: 0 auto; min-height: 100vh; background: var(--bg-primary); padding-bottom: 80px; }
    .header { padding: 16px 20px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; }
    .header-top { display: flex; justify-content: space-between; align-items: center; }
    .header-title { font-size: 20px; font-weight: 700; }
    .header-date { font-size: 13px; color: var(--text-secondary); }
    .header-actions { display: flex; gap: 8px; }
    .icon-btn { width: 36px; height: 36px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
    .icon-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    
    .tab-nav { display: flex; gap: 8px; padding: 12px 20px; background: var(--bg-secondary); overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .tab-nav::-webkit-scrollbar { display: none; }
    .tab-btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border-color); background: transparent; color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.15s; }
    .tab-btn.active { background: var(--accent-cyan); color: var(--bg-primary); border-color: var(--accent-cyan); }
    .tab-btn:not(.active):hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    
    .calendar-strip { padding: 16px 20px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .calendar-month { font-size: 16px; font-weight: 600; }
    .calendar-nav { display: flex; gap: 8px; }
    .calendar-nav-btn { padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-secondary); cursor: pointer; font-size: 12px; }
    .calendar-days { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; -webkit-overflow-scrolling: touch; }
    .calendar-days::-webkit-scrollbar { display: none; }
    .calendar-day { flex-shrink: 0; width: 44px; padding: 8px 4px; border-radius: 12px; background: var(--bg-card); border: 1px solid var(--border-color); text-align: center; cursor: pointer; transition: all 0.15s; }
    .calendar-day:hover { border-color: var(--accent-cyan); }
    .calendar-day.selected { background: var(--accent-cyan); border-color: var(--accent-cyan); }
    .calendar-day.today { border-color: var(--accent-teal); }
    .calendar-day-name { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
    .calendar-day.selected .calendar-day-name { color: var(--bg-primary); }
    .calendar-day-num { font-size: 16px; font-weight: 600; }
    .calendar-day.selected .calendar-day-num { color: var(--bg-primary); }
    .calendar-day-dots { display: flex; justify-content: center; gap: 3px; margin-top: 4px; min-height: 6px; }
    .calendar-day-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent-teal); }
    .calendar-day.selected .calendar-day-dot { background: var(--bg-primary); }
    
    .content { padding: 16px 20px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .section-title { font-size: 16px; font-weight: 600; }
    .section-count { font-size: 12px; color: var(--text-muted); background: var(--bg-card); padding: 4px 10px; border-radius: 12px; }
    
    .schedule-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 16px; margin-bottom: 12px; transition: all 0.15s; }
    .schedule-card:hover { border-color: var(--accent-cyan); }
    .schedule-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .schedule-card-info { flex: 1; }
    .schedule-card-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .schedule-card-dose { font-size: 13px; color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; }
    .schedule-card-badge { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .badge-morning { background: rgba(251, 191, 36, 0.15); color: #FBBF24; }
    .badge-evening { background: rgba(139, 92, 246, 0.15); color: #A78BFA; }
    .badge-anytime { background: rgba(34, 211, 238, 0.15); color: var(--accent-cyan); }
    .schedule-card-details { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .schedule-detail { display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-secondary); }
    .schedule-detail svg { width: 14px; height: 14px; color: var(--text-muted); }
    .schedule-card-actions { display: flex; gap: 8px; }
    .action-btn { flex: 1; padding: 10px 16px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .action-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    .action-btn.taken { background: rgba(16, 185, 129, 0.15); border-color: var(--accent-green); color: var(--accent-green); }
    .action-btn.skipped { background: rgba(239, 68, 68, 0.15); border-color: var(--accent-red); color: var(--accent-red); }
    
    .status-indicator { display: flex; align-items: center; gap: 6px; font-size: 12px; padding: 6px 12px; border-radius: 8px; margin-bottom: 12px; }
    .status-taken { background: rgba(16, 185, 129, 0.1); color: var(--accent-green); }
    .status-skipped { background: rgba(239, 68, 68, 0.1); color: var(--accent-red); }
    .schedule-notes { font-size: 12px; color: var(--text-muted); font-style: italic; padding-top: 8px; border-top: 1px solid var(--border-color); }
    .cycle-progress { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); }
    .cycle-label { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; display: flex; justify-content: space-between; }
    .cycle-bar { height: 4px; background: var(--bg-secondary); border-radius: 2px; overflow: hidden; }
    .cycle-fill { height: 100%; background: linear-gradient(90deg, var(--accent-cyan), var(--accent-teal)); border-radius: 2px; transition: width 0.3s; }
    
    .add-schedule-btn { width: 100%; padding: 16px; border-radius: 16px; border: 2px dashed var(--border-color); background: transparent; color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 12px; }
    .add-schedule-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    
    .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: var(--bg-secondary); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; padding: 8px 16px; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
    .nav-item { display: flex; flex-direction: column; align-items: center; padding: 8px 12px; border-radius: 12px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; transition: all 0.15s; }
    .nav-item.active { color: var(--accent-cyan); }
    .nav-item svg { width: 22px; height: 22px; margin-bottom: 4px; }
    .nav-item span { font-size: 10px; font-weight: 500; }
    
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); display: flex; align-items: flex-end; justify-content: center; z-index: 1000; animation: fadeIn 0.2s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal { width: 100%; max-width: 430px; max-height: 90vh; background: var(--bg-secondary); border-radius: 24px 24px 0 0; padding: 20px; overflow-y: auto; animation: slideUp 0.3s; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .modal-handle { width: 40px; height: 4px; background: var(--border-color); border-radius: 2px; margin: 0 auto 16px; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-size: 18px; font-weight: 600; }
    .modal-close { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--bg-card); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; }
    
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
    .form-input { width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; font-family: inherit; transition: border-color 0.15s; }
    .form-input:focus { outline: none; border-color: var(--accent-cyan); }
    .form-input::placeholder { color: var(--text-muted); }
    .form-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394A3B8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 40px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .day-selector { display: flex; flex-wrap: wrap; gap: 8px; }
    .day-chip { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.15s; }
    .day-chip.selected { background: var(--accent-cyan); border-color: var(--accent-cyan); color: var(--bg-primary); }
    .form-submit { width: 100%; padding: 14px; border-radius: 12px; border: none; background: var(--accent-cyan); color: var(--bg-primary); font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.15s; margin-top: 8px; }
    .form-submit:hover { background: var(--accent-teal); }
    .form-delete { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--accent-red); background: transparent; color: var(--accent-red); font-size: 15px; font-weight: 600; cursor: pointer; margin-top: 8px; }
    
    .empty-state { text-align: center; padding: 40px 20px; }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; }
    .empty-state-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
    .empty-state-text { font-size: 14px; color: var(--text-secondary); }
    
    .settings-section { margin-bottom: 24px; }
    .settings-title { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
    .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
    .settings-item:hover { border-color: var(--accent-cyan); }
    .settings-item-label { font-size: 14px; }
    .settings-item-value { font-size: 13px; color: var(--text-muted); }
    
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
    .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 16px; text-align: center; }
    .stat-value { font-size: 28px; font-weight: 700; color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; }
    .stat-label { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
    
    .search-container { margin-bottom: 16px; }
    .search-input { width: 100%; padding: 12px 16px 12px 44px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-primary); font-size: 14px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='M21 21l-4.35-4.35'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: 14px center; }
    .search-input:focus { outline: none; border-color: var(--accent-cyan); }
    
    .peptide-list-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
    .peptide-list-item:hover { border-color: var(--accent-cyan); }
    .peptide-list-info h4 { font-size: 14px; font-weight: 500; margin-bottom: 2px; }
    .peptide-list-info p { font-size: 12px; color: var(--text-muted); }
    .peptide-category-badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
    .category-fda { background: rgba(16, 185, 129, 0.15); color: var(--accent-green); }
    .category-bio { background: rgba(167, 139, 250, 0.15); color: var(--accent-purple); }
    .category-research { background: rgba(34, 211, 238, 0.15); color: var(--accent-cyan); }
    
    .filter-tabs { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .filter-tab { padding: 6px 12px; border-radius: 16px; border: 1px solid var(--border-color); background: transparent; color: var(--text-secondary); font-size: 12px; cursor: pointer; transition: all 0.15s; }
    .filter-tab.active { background: var(--accent-cyan); color: var(--bg-primary); border-color: var(--accent-cyan); }
    
    .history-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 8px; }
    .history-status { width: 8px; height: 8px; border-radius: 50%; }
    .history-status.taken { background: var(--accent-green); }
    .history-status.skipped { background: var(--accent-red); }
    .history-info { flex: 1; }
    .history-name { font-size: 14px; font-weight: 500; }
    .history-time { font-size: 12px; color: var(--text-muted); }
    .history-dose { font-size: 13px; color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; }
    
    .peptide-suggestions { max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 12px; margin-top: 8px; }
    .peptide-suggestion { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid var(--border-color); transition: background 0.15s; }
    .peptide-suggestion:last-child { border-bottom: none; }
    .peptide-suggestion:hover { background: var(--bg-card-hover); }
    .peptide-suggestion-name { font-size: 14px; font-weight: 500; }
    .peptide-suggestion-info { font-size: 12px; color: var(--text-muted); }

    /* Tools / Calculator */
    .tools-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 16px 20px 24px;
    }
    .tool-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
    }
    .tool-card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .tool-card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }
    .tool-grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .tool-input {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }
    .tool-input label {
      color: var(--text-secondary);
    }
    .tool-input input {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 13px;
      font-family: 'JetBrains Mono', monospace;
    }
    .tool-results {
      margin-top: 12px;
      font-size: 12px;
      display: grid;
      gap: 4px;
    }
    .tool-result-line {
      display: flex;
      justify-content: space-between;
      color: var(--text-secondary);
    }
    .tool-result-label {
      opacity: 0.8;
    }
    .tool-result-value {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-cyan);
    }
    .syringe-wrapper {
      display: flex;
      align-items: flex-end;
      gap: 12px;
      margin-top: 12px;
    }
    .syringe {
      height: 180px;
      width: 40px;
      border-radius: 999px;
      border: 2px solid var(--border-color);
      padding: 4px;
      display: flex;
      align-items: stretch;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.25), transparent);
    }
    .syringe-barrel {
      position: relative;
      flex: 1;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.85);
    }
    .syringe-fill {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, var(--accent-cyan), rgba(34, 211, 238, 0.2));
    }
    .syringe-mark {
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
      background: rgba(148, 163, 184, 0.5);
    }
    .syringe-labels {
      font-size: 11px;
      color: var(--text-secondary);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .syringe-label-main {
      font-weight: 600;
      color: var(--accent-cyan);
    }

  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    const CORRECT_PIN = '0119';
    
    // FULL 97 PEPTIDE DATABASE
    const PEPTIDE_DATABASE = [
      // FDA-Approved (30)
      { id: 1, name: 'Semaglutide (Ozempic/Wegovy)', category: 'FDA-Approved', uses: 'Weight loss, Type 2 diabetes', defaultDose: '0.25-2.4mg', frequency: 'Weekly' },
      { id: 2, name: 'Tirzepatide (Mounjaro/Zepbound)', category: 'FDA-Approved', uses: 'Weight loss, Type 2 diabetes', defaultDose: '2.5-15mg', frequency: 'Weekly' },
      { id: 3, name: 'Liraglutide (Saxenda/Victoza)', category: 'FDA-Approved', uses: 'Weight loss, Type 2 diabetes', defaultDose: '0.6-3mg', frequency: 'Daily' },
      { id: 4, name: 'Dulaglutide (Trulicity)', category: 'FDA-Approved', uses: 'Type 2 diabetes', defaultDose: '0.75-4.5mg', frequency: 'Weekly' },
      { id: 5, name: 'Exenatide (Byetta/Bydureon)', category: 'FDA-Approved', uses: 'Type 2 diabetes', defaultDose: '5-10mcg', frequency: 'Twice daily' },
      { id: 6, name: 'Insulin Glargine (Lantus)', category: 'FDA-Approved', uses: 'Diabetes', defaultDose: 'Variable', frequency: 'Daily' },
      { id: 7, name: 'Insulin Lispro (Humalog)', category: 'FDA-Approved', uses: 'Diabetes', defaultDose: 'Variable', frequency: 'With meals' },
      { id: 8, name: 'Insulin Aspart (NovoLog)', category: 'FDA-Approved', uses: 'Diabetes', defaultDose: 'Variable', frequency: 'With meals' },
      { id: 9, name: 'Tesamorelin (Egrifta)', category: 'FDA-Approved', uses: 'HIV lipodystrophy, GH release', defaultDose: '2mg', frequency: 'Daily' },
      { id: 10, name: 'Sermorelin', category: 'FDA-Approved', uses: 'Growth hormone deficiency', defaultDose: '200-300mcg', frequency: 'Daily' },
      { id: 11, name: 'Gonadorelin', category: 'FDA-Approved', uses: 'Fertility, hypogonadism', defaultDose: '100mcg', frequency: '2-3x weekly' },
      { id: 12, name: 'Leuprolide (Lupron)', category: 'FDA-Approved', uses: 'Prostate cancer, endometriosis', defaultDose: '7.5-45mg', frequency: 'Monthly' },
      { id: 13, name: 'Octreotide (Sandostatin)', category: 'FDA-Approved', uses: 'Acromegaly, carcinoid', defaultDose: '50-200mcg', frequency: '2-4x daily' },
      { id: 14, name: 'Lanreotide (Somatuline)', category: 'FDA-Approved', uses: 'Acromegaly', defaultDose: '60-120mg', frequency: 'Monthly' },
      { id: 15, name: 'Teriparatide (Forteo)', category: 'FDA-Approved', uses: 'Osteoporosis', defaultDose: '20mcg', frequency: 'Daily' },
      { id: 16, name: 'Abaloparatide (Tymlos)', category: 'FDA-Approved', uses: 'Osteoporosis', defaultDose: '80mcg', frequency: 'Daily' },
      { id: 17, name: 'Calcitonin-Salmon', category: 'FDA-Approved', uses: 'Osteoporosis, hypercalcemia', defaultDose: '100IU', frequency: 'Daily' },
      { id: 18, name: 'Vasopressin (ADH)', category: 'FDA-Approved', uses: 'Diabetes insipidus', defaultDose: '5-10 units', frequency: 'As needed' },
      { id: 19, name: 'Desmopressin (DDAVP)', category: 'FDA-Approved', uses: 'Diabetes insipidus', defaultDose: '10-40mcg', frequency: 'Daily' },
      { id: 20, name: 'Oxytocin (Pitocin)', category: 'FDA-Approved', uses: 'Labor induction', defaultDose: 'Variable', frequency: 'As needed' },
      { id: 21, name: 'Glucagon', category: 'FDA-Approved', uses: 'Severe hypoglycemia', defaultDose: '1mg', frequency: 'Emergency' },
      { id: 22, name: 'Pramlintide (Symlin)', category: 'FDA-Approved', uses: 'Diabetes', defaultDose: '15-120mcg', frequency: 'With meals' },
      { id: 23, name: 'Romiplostim (Nplate)', category: 'FDA-Approved', uses: 'Low platelets (ITP)', defaultDose: '1-10mcg/kg', frequency: 'Weekly' },
      { id: 24, name: 'Pegvisomant (Somavert)', category: 'FDA-Approved', uses: 'Acromegaly', defaultDose: '10-30mg', frequency: 'Daily' },
      { id: 25, name: 'Cosyntropin', category: 'FDA-Approved', uses: 'Adrenal testing', defaultDose: '250mcg', frequency: 'Single test' },
      { id: 26, name: 'Afamelanotide (Scenesse)', category: 'FDA-Approved', uses: 'EPP (light sensitivity)', defaultDose: '16mg', frequency: 'Monthly' },
      { id: 27, name: 'Bremelanotide (Vyleesi)', category: 'FDA-Approved', uses: 'Female sexual dysfunction', defaultDose: '1.75mg', frequency: 'As needed' },
      { id: 28, name: 'Setmelanotide (Imcivree)', category: 'FDA-Approved', uses: 'Genetic obesity', defaultDose: '2-3mg', frequency: 'Daily' },
      { id: 29, name: 'Pasireotide (Signifor)', category: 'FDA-Approved', uses: "Cushing's disease", defaultDose: '0.3-0.9mg', frequency: 'Twice daily' },
      { id: 30, name: 'Icatibant (Firazyr)', category: 'FDA-Approved', uses: 'Hereditary angioedema', defaultDose: '30mg', frequency: 'As needed' },
      
      // Khavinson Bioregulators (21)
      { id: 31, name: 'Epithalon (Epitalon)', category: 'Bioregulator', uses: 'Telomere, anti-aging, pineal', defaultDose: '5-10mg', frequency: '10-day cycles' },
      { id: 32, name: 'Thymalin', category: 'Bioregulator', uses: 'Immune system, thymus', defaultDose: '10mg', frequency: '10-day cycles' },
      { id: 33, name: 'Cortexin', category: 'Bioregulator', uses: 'Brain function, cognition', defaultDose: '10mg', frequency: 'Daily for 10 days' },
      { id: 34, name: 'Retinalamin', category: 'Bioregulator', uses: 'Eye health, retina', defaultDose: '5mg', frequency: 'Daily for 10 days' },
      { id: 35, name: 'Prostatilen', category: 'Bioregulator', uses: 'Prostate health', defaultDose: '5-10mg', frequency: 'Daily for 10 days' },
      { id: 36, name: 'Thymulin', category: 'Bioregulator', uses: 'Immune modulation', defaultDose: '1-5mg', frequency: '10-day cycles' },
      { id: 37, name: 'Vilon', category: 'Bioregulator', uses: 'Immune system', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 38, name: 'Livagen', category: 'Bioregulator', uses: 'Liver function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 39, name: 'Crystagen', category: 'Bioregulator', uses: 'Immune system', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 40, name: 'Cardiogen', category: 'Bioregulator', uses: 'Heart function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 41, name: 'Bronchogen', category: 'Bioregulator', uses: 'Lung function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 42, name: 'Vesugen', category: 'Bioregulator', uses: 'Blood vessels', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 43, name: 'Chonluten', category: 'Bioregulator', uses: 'Lung mucosa', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 44, name: 'Ovagen', category: 'Bioregulator', uses: 'Liver, GI tract', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 45, name: 'Pancragen', category: 'Bioregulator', uses: 'Pancreas function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 46, name: 'Pinealon', category: 'Bioregulator', uses: 'Brain, pineal gland', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 47, name: 'Testagen', category: 'Bioregulator', uses: 'Testes function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 48, name: 'Ventfort', category: 'Bioregulator', uses: 'Blood vessels', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 49, name: 'Cerluten', category: 'Bioregulator', uses: 'Brain function', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 50, name: 'Sigumir', category: 'Bioregulator', uses: 'Cartilage, joints', defaultDose: '10mcg', frequency: 'Daily' },
      { id: 51, name: 'Svetinorm', category: 'Bioregulator', uses: 'Liver function', defaultDose: '10mcg', frequency: 'Daily' },
      
      // Research Peptides (46)
      { id: 52, name: 'BPC-157', category: 'Research', uses: 'Healing, gut health, injury repair', defaultDose: '250-500mcg', frequency: 'Twice daily' },
      { id: 53, name: 'TB-500 (Thymosin Beta-4)', category: 'Research', uses: 'Healing, tissue repair, flexibility', defaultDose: '2-5mg', frequency: '2x weekly' },
      { id: 54, name: 'GHK-Cu', category: 'Research', uses: 'Skin, hair, wound healing', defaultDose: '1-2mg', frequency: 'Daily' },
      { id: 55, name: 'Ipamorelin', category: 'Research', uses: 'Growth hormone release', defaultDose: '200-300mcg', frequency: '2-3x daily' },
      { id: 56, name: 'CJC-1295 (with DAC)', category: 'Research', uses: 'Growth hormone release', defaultDose: '1-2mg', frequency: 'Weekly' },
      { id: 57, name: 'CJC-1295 (no DAC/Mod GRF)', category: 'Research', uses: 'Growth hormone release', defaultDose: '100mcg', frequency: '2-3x daily' },
      { id: 58, name: 'GHRP-6', category: 'Research', uses: 'Growth hormone, appetite', defaultDose: '100-300mcg', frequency: '2-3x daily' },
      { id: 59, name: 'GHRP-2', category: 'Research', uses: 'Growth hormone release', defaultDose: '100-300mcg', frequency: '2-3x daily' },
      { id: 60, name: 'Hexarelin', category: 'Research', uses: 'Growth hormone, heart', defaultDose: '100-200mcg', frequency: '2-3x daily' },
      { id: 61, name: 'MK-677 (Ibutamoren)', category: 'Research', uses: 'Growth hormone, sleep', defaultDose: '10-25mg', frequency: 'Daily (oral)' },
      { id: 62, name: 'PT-141 (Bremelanotide)', category: 'Research', uses: 'Sexual function', defaultDose: '1-2mg', frequency: 'As needed' },
      { id: 63, name: 'Melanotan II', category: 'Research', uses: 'Tanning, libido', defaultDose: '0.25-1mg', frequency: 'Daily loading' },
      { id: 64, name: 'Melanotan I (Afamelanotide)', category: 'Research', uses: 'Tanning, skin protection', defaultDose: '1mg', frequency: 'Daily' },
      { id: 65, name: 'AOD-9604', category: 'Research', uses: 'Fat loss', defaultDose: '300mcg', frequency: 'Daily' },
      { id: 66, name: 'Fragment 176-191', category: 'Research', uses: 'Fat loss', defaultDose: '250-500mcg', frequency: 'Daily' },
      { id: 67, name: 'Follistatin 344', category: 'Research', uses: 'Muscle growth', defaultDose: '100mcg', frequency: 'Daily' },
      { id: 68, name: 'ACE-031', category: 'Research', uses: 'Muscle growth', defaultDose: 'Variable', frequency: 'Weekly' },
      { id: 69, name: 'IGF-1 LR3', category: 'Research', uses: 'Muscle growth, recovery', defaultDose: '20-50mcg', frequency: 'Daily' },
      { id: 70, name: 'IGF-1 DES', category: 'Research', uses: 'Localized muscle growth', defaultDose: '50-150mcg', frequency: 'Pre-workout' },
      { id: 71, name: 'MGF (Mechano Growth Factor)', category: 'Research', uses: 'Muscle recovery', defaultDose: '100-200mcg', frequency: 'Post-workout' },
      { id: 72, name: 'PEG-MGF', category: 'Research', uses: 'Muscle growth', defaultDose: '200mcg', frequency: '2-3x weekly' },
      { id: 73, name: 'Selank', category: 'Research', uses: 'Anxiety, cognition', defaultDose: '250-500mcg', frequency: 'Daily (nasal)' },
      { id: 74, name: 'Semax', category: 'Research', uses: 'Cognition, focus, BDNF', defaultDose: '200-600mcg', frequency: 'Daily (nasal)' },
      { id: 75, name: 'NA-Semax Amidate', category: 'Research', uses: 'Enhanced cognition', defaultDose: '200-600mcg', frequency: 'Daily (nasal)' },
      { id: 76, name: 'Dihexa', category: 'Research', uses: 'Cognition, memory', defaultDose: '10-20mg', frequency: 'Daily (oral)' },
      { id: 77, name: 'P21 (Cerebrolysin peptide)', category: 'Research', uses: 'Neurogenesis', defaultDose: '1-2mg', frequency: 'Daily' },
      { id: 78, name: 'LL-37', category: 'Research', uses: 'Antimicrobial, immune', defaultDose: '50-100mcg', frequency: 'Daily' },
      { id: 79, name: 'Thymosin Alpha-1', category: 'Research', uses: 'Immune modulation', defaultDose: '1.6mg', frequency: '2x weekly' },
      { id: 80, name: 'KPV', category: 'Research', uses: 'Anti-inflammatory, gut', defaultDose: '200-500mcg', frequency: 'Daily' },
      { id: 81, name: 'VIP (Vasoactive Intestinal Peptide)', category: 'Research', uses: 'CIRS, mold illness', defaultDose: '50mcg', frequency: '4x daily (nasal)' },
      { id: 82, name: 'DSIP (Delta Sleep Inducing)', category: 'Research', uses: 'Sleep, recovery', defaultDose: '100-300mcg', frequency: 'Before bed' },
      { id: 83, name: 'Epitalon', category: 'Research', uses: 'Telomeres, anti-aging', defaultDose: '5-10mg', frequency: '10-day cycles' },
      { id: 84, name: 'SS-31 (Elamipretide)', category: 'Research', uses: 'Mitochondria, energy', defaultDose: '0.25mg/kg', frequency: 'Daily' },
      { id: 85, name: 'MOTS-c', category: 'Research', uses: 'Metabolism, exercise', defaultDose: '5-10mg', frequency: '3x weekly' },
      { id: 86, name: 'Humanin', category: 'Research', uses: 'Neuroprotection', defaultDose: '1-5mg', frequency: 'Daily' },
      { id: 87, name: 'GLP-1 (7-36)', category: 'Research', uses: 'Blood sugar, appetite', defaultDose: 'Variable', frequency: 'Variable' },
      { id: 88, name: 'Kisspeptin-10', category: 'Research', uses: 'Hormone regulation', defaultDose: '1-5mcg/kg', frequency: 'Pulsatile' },
      { id: 89, name: 'SNAP-8', category: 'Research', uses: 'Wrinkle reduction', defaultDose: 'Topical', frequency: 'Daily (topical)' },
      { id: 90, name: 'Argireline', category: 'Research', uses: 'Wrinkle reduction', defaultDose: 'Topical', frequency: 'Daily (topical)' },
      { id: 91, name: 'Copper Peptide AHK-Cu', category: 'Research', uses: 'Hair growth', defaultDose: 'Topical', frequency: 'Daily (topical)' },
      { id: 92, name: 'Adipotide (FTPP)', category: 'Research', uses: 'Fat loss (experimental)', defaultDose: '0.1-0.5mg/kg', frequency: 'Daily' },
      { id: 93, name: 'Tesamorelin/Ipamorelin combo', category: 'Research', uses: 'GH release synergy', defaultDose: 'Variable', frequency: 'Daily' },
      { id: 94, name: 'CJC/Ipamorelin combo', category: 'Research', uses: 'GH release synergy', defaultDose: '100mcg each', frequency: '2-3x daily' },
      { id: 95, name: 'BPC-157/TB-500 combo', category: 'Research', uses: 'Enhanced healing', defaultDose: '500mcg/2mg', frequency: 'Daily/2x weekly' },
      { id: 96, name: 'Retatrutide', category: 'Research', uses: 'Weight loss (triple agonist)', defaultDose: '1-12mg', frequency: 'Weekly' },
      { id: 97, name: 'Survodutide', category: 'Research', uses: 'Weight loss, NASH', defaultDose: 'Variable', frequency: 'Weekly' }
    ];
    
    // Your pre-loaded schedule
    const INITIAL_SCHEDULES = [
      { id: '1', name: 'TB-500', dosage: '500 mcg', frequency: 'twice/day', daysPerWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], timeOfDay: 'anytime', startDate: '2025-11-26', endDate: '2026-02-18', cycleWeeks: 12, notes: '' },
      { id: '2', name: 'BPC-157', dosage: '500 mcg', frequency: 'twice/day', daysPerWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], timeOfDay: 'anytime', startDate: '2025-11-26', endDate: '2026-02-18', cycleWeeks: 12, notes: '' },
      { id: '3', name: 'Tesamorelin', dosage: '500 mcg', frequency: 'once/day', daysPerWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], timeOfDay: 'evening', startDate: '2025-11-26', endDate: null, cycleWeeks: 8, notes: '5 nights/week' },
      { id: '4', name: 'Tirzepatide', dosage: '5 mg', frequency: 'once/week', daysPerWeek: ['Mon'], timeOfDay: 'morning', startDate: '2025-12-02', endDate: null, cycleWeeks: null, notes: '' },
      { id: '5', name: 'Testosterone Cypionate', dosage: '2 mg', frequency: 'twice/week', daysPerWeek: ['Mon', 'Thu'], timeOfDay: 'morning', startDate: null, endDate: null, cycleWeeks: 16, notes: 'TRT - Ongoing' },
      { id: '6', name: 'HCG', dosage: '500 IU', frequency: 'twice/week', daysPerWeek: ['Mon', 'Thu'], timeOfDay: 'morning', startDate: null, endDate: null, cycleWeeks: null, notes: 'Same days as TRT' },
      { id: '7', name: 'Glutathione', dosage: '600 mg', frequency: 'over 3 days', daysPerWeek: ['Mon', 'Wed', 'Fri'], timeOfDay: 'anytime', startDate: '2025-12-03', endDate: null, cycleWeeks: 12, notes: '3 days/week' },
      { id: '8', name: 'KLOW', dosage: '1250 Âµg', frequency: 'once/day', daysPerWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], timeOfDay: 'anytime', startDate: '2025-12-03', endDate: null, cycleWeeks: 16, notes: '5 days/week' }
    ];
    
    // Icons
    const Icons = {
      Calendar: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      Check: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      Plus: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      Home: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      List: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
      Clock: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Settings: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1.08-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1.08 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
      Database: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
      ChevronLeft: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"/></svg>,
      ChevronRight: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      Download: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      Upload: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
      Search: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    };
    
    // PIN Screen
    function PinScreen({ onUnlock }) {
      const [pin, setPin] = useState('');
      const [error, setError] = useState(false);
      
      const handleKeyPress = (key) => {
        if (error) setError(false);
        if (key === 'delete') {
          setPin(prev => prev.slice(0, -1));
        } else if (pin.length < 4) {
          const newPin = pin + key;
          setPin(newPin);
          if (newPin.length === 4) {
            if (newPin === CORRECT_PIN) {
              setTimeout(() => onUnlock(), 200);
            } else {
              setError(true);
              setTimeout(() => { setPin(''); setError(false); }, 600);
            }
          }
        }
      };
      
      return (
        <div className="pin-container">
          <div className="pin-logo">ðŸ’‰</div>
          <h1 className="pin-title">Shot Tracker</h1>
          <p className="pin-subtitle">Enter your PIN to unlock</p>
          <div className="pin-dots">
            {[0,1,2,3].map(i => <div key={i} className={`pin-dot ${pin.length > i ? 'filled' : ''} ${error ? 'error' : ''}`}/>)}
          </div>
          <div className="pin-keypad">
            {[1,2,3,4,5,6,7,8,9,'',0,'âŒ«'].map((key, i) => (
              <button key={i} className={`pin-key ${key === '' ? 'empty' : ''}`} onClick={() => key !== '' && handleKeyPress(key === 'âŒ«' ? 'delete' : key.toString())}>{key}</button>
            ))}
          </div>
        </div>
      );
    }
    
    // Main App
    function App() {
      const [isUnlocked, setIsUnlocked] = useState(false);
      const [activeTab, setActiveTab] = useState('today');
      const [selectedDate, setSelectedDate] = useState(new Date());
      const [schedules, setSchedules] = useState([]);
      const [logs, setLogs] = useState({});
      const [showModal, setShowModal] = useState(false);
      const [editingSchedule, setEditingSchedule] = useState(null);
      const [dbSearch, setDbSearch] = useState('');
      const [dbFilter, setDbFilter] = useState('All');
      const [dataLoaded, setDataLoaded] = useState(false);
      
      // Load data on mount - only runs once
      useEffect(() => {
        try {
          const saved = localStorage.getItem('peptide-schedules');
          const savedLogs = localStorage.getItem('peptide-logs');
          const savedUnlock = sessionStorage.getItem('peptide-unlocked');
          
          if (saved) {
            const parsed = JSON.parse(saved);
            if (Array.isArray(parsed) && parsed.length > 0) {
              setSchedules(parsed);
            } else {
              setSchedules(INITIAL_SCHEDULES);
            }
          } else {
            setSchedules(INITIAL_SCHEDULES);
          }
          
          if (savedLogs) {
            const parsedLogs = JSON.parse(savedLogs);
            if (parsedLogs && typeof parsedLogs === 'object') {
              setLogs(parsedLogs);
            }
          }
          
          if (savedUnlock === 'true') setIsUnlocked(true);
          
          // Mark data as loaded AFTER setting state
          setTimeout(() => setDataLoaded(true), 100);
        } catch (e) {
          console.error('Error loading data:', e);
          setSchedules(INITIAL_SCHEDULES);
          setDataLoaded(true);
        }
      }, []);
      
      // Save schedules - only after initial load
      useEffect(() => {
        if (dataLoaded && schedules.length > 0) {
          try {
            localStorage.setItem('peptide-schedules', JSON.stringify(schedules));
            console.log('Schedules saved:', schedules.length);
          } catch (e) {
            console.error('Error saving schedules:', e);
          }
        }
      }, [schedules, dataLoaded]);
      
      // Save logs - only after initial load  
      useEffect(() => {
        if (dataLoaded) {
          try {
            localStorage.setItem('peptide-logs', JSON.stringify(logs));
            console.log('Logs saved:', Object.keys(logs).length);
          } catch (e) {
            console.error('Error saving logs:', e);
          }
        }
      }, [logs, dataLoaded]);
      
      const handleUnlock = () => { setIsUnlocked(true); sessionStorage.setItem('peptide-unlocked', 'true'); };
      
      const formatDate = (date) => date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
      const getDateKey = (date) => date.toISOString().split('T')[0];
      const getDayName = (date) => date.toLocaleDateString('en-US', { weekday: 'short' });
      
      const getSchedulesForDate = (date) => {
        const dayName = getDayName(date);
        const dateStr = getDateKey(date);
        return schedules.filter(s => {
          if (!s.daysPerWeek.includes(dayName)) return false;
          if (s.startDate && dateStr < s.startDate) return false;
          if (s.endDate && dateStr > s.endDate) return false;
          return true;
        });
      };
      
      const logDose = (scheduleId, status) => {
        const logKey = `${getDateKey(selectedDate)}-${scheduleId}`;
        setLogs(prev => ({ ...prev, [logKey]: { status, timestamp: new Date().toISOString() } }));
      };
      
      const getLogStatus = (scheduleId) => logs[`${getDateKey(selectedDate)}-${scheduleId}`];
      
      const getCycleProgress = (schedule) => {
        if (!schedule.startDate || !schedule.cycleWeeks) return null;
        const daysDiff = Math.floor((selectedDate - new Date(schedule.startDate)) / (1000 * 60 * 60 * 24));
        const weeksDiff = Math.floor(daysDiff / 7) + 1;
        return { currentWeek: Math.min(weeksDiff, schedule.cycleWeeks), totalWeeks: schedule.cycleWeeks, progress: Math.min((weeksDiff / schedule.cycleWeeks) * 100, 100) };
      };
      
      const getCalendarDays = () => {
        const days = [];
        const startOfWeek = new Date(selectedDate);
        startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
        for (let i = 0; i < 14; i++) {
          const date = new Date(startOfWeek);
          date.setDate(date.getDate() + i);
          days.push({ date, dayName: date.toLocaleDateString('en-US', { weekday: 'short' }), dayNum: date.getDate(), isSelected: getDateKey(date) === getDateKey(selectedDate), isToday: getDateKey(date) === getDateKey(new Date()), scheduleCount: getSchedulesForDate(date).length });
        }
        return days;
      };
      
      const saveSchedule = (data) => {
        if (editingSchedule) setSchedules(prev => prev.map(s => s.id === editingSchedule.id ? { ...data, id: s.id } : s));
        else setSchedules(prev => [...prev, { ...data, id: Date.now().toString() }]);
        setShowModal(false);
        setEditingSchedule(null);
      };
      
      const deleteSchedule = (id) => { setSchedules(prev => prev.filter(s => s.id !== id)); setShowModal(false); setEditingSchedule(null); };
      
      const exportData = () => {
        const blob = new Blob([JSON.stringify({ schedules, logs }, null, 2)], { type: 'application/json' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `peptide-backup-${getDateKey(new Date())}.json`; a.click();
      };
      
      const importData = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (ev) => {
            try {
              const data = JSON.parse(ev.target.result);
              if (data.schedules) setSchedules(data.schedules);
              if (data.logs) setLogs(data.logs);
              alert('Data imported!');
            } catch { alert('Error importing'); }
          };
          reader.readAsText(file);
        }
      };
      
      const filteredPeptides = useMemo(() => {
        return PEPTIDE_DATABASE.filter(p => {
          const matchesSearch = p.name.toLowerCase().includes(dbSearch.toLowerCase()) || p.uses.toLowerCase().includes(dbSearch.toLowerCase());
          const matchesFilter = dbFilter === 'All' || p.category === dbFilter;
          return matchesSearch && matchesFilter;
        });
      }, [dbSearch, dbFilter]);
      
      const addFromDatabase = (peptide) => {
        setEditingSchedule(null);
        setShowModal(true);
        setTimeout(() => {
          const event = new CustomEvent('prefillPeptide', { detail: peptide });
          window.dispatchEvent(event);
        }, 100);
      };
      
      if (!isUnlocked) return <PinScreen onUnlock={handleUnlock} />;
      
      const todaySchedules = getSchedulesForDate(selectedDate);
      const todayStats = { total: todaySchedules.length, taken: todaySchedules.filter(s => getLogStatus(s.id)?.status === 'taken').length, skipped: todaySchedules.filter(s => getLogStatus(s.id)?.status === 'skipped').length };
      
      return (
        <div className="app-container">
          <header className="header">
            <div className="header-top">
              <div>
                <h1 className="header-title">Shot Tracker</h1>
                <p className="header-date">{formatDate(selectedDate)}</p>
              </div>
              <div className="header-actions">
                <button className="icon-btn" onClick={exportData} title="Export"><Icons.Download /></button>
              </div>
            </div>
          </header>
          
          <nav className="tab-nav">
            {['today', 'schedules', 'database', 'tools', 'history', 'settings'].map(tab => (
              <button key={tab} className={`tab-btn ${activeTab === tab ? 'active' : ''}`} onClick={() => setActiveTab(tab)}>
                {tab.charAt(0).toUpperCase() + tab.slice(1)}
              </button>
            ))}
          </nav>
          
          {(activeTab === 'today' || activeTab === 'history') && (
            <div className="calendar-strip">
              <div className="calendar-header">
                <span className="calendar-month">{selectedDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
                <div className="calendar-nav">
                  <button className="calendar-nav-btn" onClick={() => { const d = new Date(selectedDate); d.setDate(d.getDate() - 7); setSelectedDate(d); }}><Icons.ChevronLeft /></button>
                  <button className="calendar-nav-btn" onClick={() => setSelectedDate(new Date())}>Today</button>
                  <button className="calendar-nav-btn" onClick={() => { const d = new Date(selectedDate); d.setDate(d.getDate() + 7); setSelectedDate(d); }}><Icons.ChevronRight /></button>
                </div>
              </div>
              <div className="calendar-days">
                {getCalendarDays().map((day, i) => (
                  <div key={i} className={`calendar-day ${day.isSelected ? 'selected' : ''} ${day.isToday ? 'today' : ''}`} onClick={() => setSelectedDate(day.date)}>
                    <div className="calendar-day-name">{day.dayName}</div>
                    <div className="calendar-day-num">{day.dayNum}</div>
                    <div className="calendar-day-dots">{Array.from({ length: Math.min(day.scheduleCount, 3) }).map((_, j) => <div key={j} className="calendar-day-dot" />)}</div>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          <main className="content">
            {activeTab === 'today' && (
              <>
                <div className="stats-grid">
                  <div className="stat-card"><div className="stat-value">{todayStats.taken}/{todayStats.total}</div><div className="stat-label">Taken Today</div></div>
                  <div className="stat-card"><div className="stat-value" style={{ color: todayStats.total - todayStats.taken - todayStats.skipped > 0 ? 'var(--accent-orange)' : 'var(--accent-green)' }}>{todayStats.total - todayStats.taken - todayStats.skipped}</div><div className="stat-label">Remaining</div></div>
                </div>
                <div className="section-header"><h2 className="section-title">Today's Schedule</h2><span className="section-count">{todaySchedules.length} doses</span></div>
                {todaySchedules.length === 0 ? (
                  <div className="empty-state"><div className="empty-state-icon">ðŸ“…</div><h3 className="empty-state-title">No doses scheduled</h3><p className="empty-state-text">Nothing scheduled for this day</p></div>
                ) : todaySchedules.map(schedule => {
                  const logStatus = getLogStatus(schedule.id);
                  const cycleProgress = getCycleProgress(schedule);
                  return (
                    <div key={schedule.id} className="schedule-card">
                      <div className="schedule-card-header">
                        <div className="schedule-card-info"><h3 className="schedule-card-name">{schedule.name}</h3><p className="schedule-card-dose">{schedule.dosage} â€¢ {schedule.frequency}</p></div>
                        <span className={`schedule-card-badge badge-${schedule.timeOfDay}`}>{schedule.timeOfDay}</span>
                      </div>
                      {logStatus && <div className={`status-indicator status-${logStatus.status}`}>{logStatus.status === 'taken' ? <Icons.Check /> : <Icons.X />} {logStatus.status === 'taken' ? 'Taken' : 'Skipped'} at {new Date(logStatus.timestamp).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>}
                      {!logStatus && <div className="schedule-card-actions"><button className="action-btn" onClick={() => logDose(schedule.id, 'taken')}><Icons.Check /> Taken</button><button className="action-btn" onClick={() => logDose(schedule.id, 'skipped')}><Icons.X /> Skip</button></div>}
                      {cycleProgress && <div className="cycle-progress"><div className="cycle-label"><span>Cycle Progress</span><span>Week {cycleProgress.currentWeek} of {cycleProgress.totalWeeks}</span></div><div className="cycle-bar"><div className="cycle-fill" style={{ width: `${cycleProgress.progress}%` }} /></div></div>}
                      {schedule.notes && <p className="schedule-notes">ðŸ“ {schedule.notes}</p>}
                    </div>
                  );
                })}
              </>
            )}
            
            {activeTab === 'schedules' && (
              <>
                <button className="add-schedule-btn" onClick={() => { setEditingSchedule(null); setShowModal(true); }}><Icons.Plus /> Add New Schedule</button>
                <div className="section-header"><h2 className="section-title">All Schedules</h2><span className="section-count">{schedules.length} total</span></div>
                {schedules.map(schedule => {
                  const cycleProgress = getCycleProgress(schedule);
                  return (
                    <div key={schedule.id} className="schedule-card" onClick={() => { setEditingSchedule(schedule); setShowModal(true); }} style={{ cursor: 'pointer' }}>
                      <div className="schedule-card-header"><div className="schedule-card-info"><h3 className="schedule-card-name">{schedule.name}</h3><p className="schedule-card-dose">{schedule.dosage} â€¢ {schedule.frequency}</p></div><span className={`schedule-card-badge badge-${schedule.timeOfDay}`}>{schedule.timeOfDay}</span></div>
                      <div className="schedule-card-details"><span className="schedule-detail"><Icons.Calendar />{schedule.daysPerWeek.join(', ')}</span>{schedule.startDate && <span className="schedule-detail"><Icons.Clock />Started {schedule.startDate}</span>}</div>
                      {cycleProgress && <div className="cycle-progress"><div className="cycle-label"><span>Cycle</span><span>Week {cycleProgress.currentWeek}/{cycleProgress.totalWeeks}</span></div><div className="cycle-bar"><div className="cycle-fill" style={{ width: `${cycleProgress.progress}%` }} /></div></div>}
                      {schedule.notes && <p className="schedule-notes">ðŸ“ {schedule.notes}</p>}
                    </div>
                  );
                })}
              </>
            )}
            
            {activeTab === 'database' && (
              <>
                <div className="search-container"><input type="text" className="search-input" placeholder="Search 97 peptides..." value={dbSearch} onChange={e => setDbSearch(e.target.value)} /></div>
                <div className="filter-tabs">
                  {['All', 'FDA-Approved', 'Bioregulator', 'Research'].map(f => (
                    <button key={f} className={`filter-tab ${dbFilter === f ? 'active' : ''}`} onClick={() => setDbFilter(f)}>{f} {f === 'All' ? `(${PEPTIDE_DATABASE.length})` : `(${PEPTIDE_DATABASE.filter(p => p.category === f).length})`}</button>
                  ))}
                </div>
                <div className="section-header"><h2 className="section-title">Peptide Database</h2><span className="section-count">{filteredPeptides.length} shown</span></div>
                {filteredPeptides.map(peptide => (
                  <div key={peptide.id} className="peptide-list-item" onClick={() => addFromDatabase(peptide)}>
                    <div className="peptide-list-info"><h4>{peptide.name}</h4><p>{peptide.uses}</p><p style={{ color: 'var(--accent-cyan)', fontFamily: 'JetBrains Mono', fontSize: '11px', marginTop: '4px' }}>{peptide.defaultDose} â€¢ {peptide.frequency}</p></div>
                    <span className={`peptide-category-badge category-${peptide.category === 'FDA-Approved' ? 'fda' : peptide.category === 'Bioregulator' ? 'bio' : 'research'}`}>{peptide.category === 'FDA-Approved' ? 'FDA' : peptide.category === 'Bioregulator' ? 'BIO' : 'RES'}</span>
                  </div>
                ))}
              </>
            )}
            

            {activeTab === 'tools' && (
              <ToolsTab />
            )}

            {activeTab === 'history' && (
              <>
                <div className="section-header"><h2 className="section-title">Dose History</h2><span className="section-count">{getDateKey(selectedDate)}</span></div>
                {Object.entries(logs).filter(([key]) => key.startsWith(getDateKey(selectedDate))).map(([key, log]) => {
                  const scheduleId = key.split('-').slice(3).join('-');
                  const schedule = schedules.find(s => s.id === scheduleId);
                  if (!schedule) return null;
                  return (
                    <div key={key} className="history-item">
                      <div className={`history-status ${log.status}`} />
                      <div className="history-info"><div className="history-name">{schedule.name}</div><div className="history-time">{new Date(log.timestamp).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div></div>
                      <div className="history-dose">{schedule.dosage}</div>
                    </div>
                  );
                })}
                {Object.entries(logs).filter(([key]) => key.startsWith(getDateKey(selectedDate))).length === 0 && <div className="empty-state"><div className="empty-state-icon">ðŸ“‹</div><h3 className="empty-state-title">No logs for this date</h3></div>}
              </>
            )}
            
            {activeTab === 'settings' && (
              <>
                <div className="settings-section">
                  <h3 className="settings-title">Data Management</h3>
                  <div className="settings-item" onClick={() => {
                    try {
                      localStorage.setItem('peptide-schedules', JSON.stringify(schedules));
                      localStorage.setItem('peptide-logs', JSON.stringify(logs));
                      alert('Data saved successfully! Schedules: ' + schedules.length + ', Logs: ' + Object.keys(logs).length);
                    } catch (e) {
                      alert('Error saving: ' + e.message);
                    }
                  }}><span className="settings-item-label">ðŸ’¾ Force Save Now</span><span className="settings-item-value">Tap to save</span></div>
                  <div className="settings-item" onClick={exportData}><span className="settings-item-label">Export Data</span><Icons.Download /></div>
                  <label className="settings-item"><span className="settings-item-label">Import Data</span><input type="file" accept=".json" onChange={importData} style={{ display: 'none' }} /><Icons.Upload /></label>
                  <div className="settings-item" onClick={() => {
                    if (confirm('This will reset ALL data to defaults. Your logs will be lost. Continue?')) {
                      localStorage.removeItem('peptide-schedules');
                      localStorage.removeItem('peptide-logs');
                      setSchedules(INITIAL_SCHEDULES);
                      setLogs({});
                      alert('Data reset to defaults');
                    }
                  }} style={{ borderColor: 'var(--accent-red)' }}><span className="settings-item-label" style={{ color: 'var(--accent-red)' }}>âš ï¸ Reset All Data</span></div>
                </div>
                <div className="settings-section">
                  <h3 className="settings-title">Storage Status</h3>
                  <div className="settings-item"><span className="settings-item-label">Data Loaded</span><span className="settings-item-value" style={{ color: dataLoaded ? 'var(--accent-green)' : 'var(--accent-orange)' }}>{dataLoaded ? 'âœ“ Yes' : 'Loading...'}</span></div>
                  <div className="settings-item"><span className="settings-item-label">Schedules in Storage</span><span className="settings-item-value">{(() => { try { const s = localStorage.getItem('peptide-schedules'); return s ? JSON.parse(s).length : 0; } catch { return 'Error'; } })()}</span></div>
                  <div className="settings-item"><span className="settings-item-label">Logs in Storage</span><span className="settings-item-value">{(() => { try { const l = localStorage.getItem('peptide-logs'); return l ? Object.keys(JSON.parse(l)).length : 0; } catch { return 'Error'; } })()}</span></div>
                </div>
                <div className="settings-section">
                  <h3 className="settings-title">App Info</h3>
                  <div className="settings-item"><span className="settings-item-label">Version</span><span className="settings-item-value">2.1.0</span></div>
                  <div className="settings-item"><span className="settings-item-label">Your Schedules</span><span className="settings-item-value">{schedules.length}</span></div>
                  <div className="settings-item"><span className="settings-item-label">Database Size</span><span className="settings-item-value">{PEPTIDE_DATABASE.length} peptides</span></div>
                  <div className="settings-item"><span className="settings-item-label">Total Logs</span><span className="settings-item-value">{Object.keys(logs).length}</span></div>
                </div>
              </>
            )}
          </main>
          
          <nav className="bottom-nav">
            <button className={`nav-item ${activeTab === 'today' ? 'active' : ''}`} onClick={() => setActiveTab('today')}><Icons.Home /><span>Today</span></button>
            <button className={`nav-item ${activeTab === 'schedules' ? 'active' : ''}`} onClick={() => setActiveTab('schedules')}><Icons.List /><span>Schedules</span></button>
            <button className={`nav-item ${activeTab === 'database' ? 'active' : ''}`} onClick={() => setActiveTab('database')}><Icons.Database /><span>Database</span></button>
            <button className={`nav-item ${activeTab === 'tools' ? 'active' : ''}`} onClick={() => setActiveTab('tools')}><Icons.Database /><span>Tools</span></button>
            <button className={`nav-item ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}><Icons.Clock /><span>History</span></button>
            <button className={`nav-item ${activeTab === 'settings' ? 'active' : ''}`} onClick={() => setActiveTab('settings')}><Icons.Settings /><span>Settings</span></button>
          </nav>
          
          {showModal && <ScheduleModal schedule={editingSchedule} onSave={saveSchedule} onDelete={deleteSchedule} onClose={() => { setShowModal(false); setEditingSchedule(null); }} />}
        </div>
      );
    }
    

    function ToolsTab() {
      const [calc, setCalc] = useState({
        vialAmountMg: '',
        bacWaterMl: '',
        doseAmountMg: '',
        syringeSizeUnits: 100,
        syringeVolumeMl: 1,
      });

      const vialMg = parseFloat(calc.vialAmountMg) || 0;
      const waterMl = parseFloat(calc.bacWaterMl) || 0;
      const doseMg = parseFloat(calc.doseAmountMg) || 0;
      const mgPerMl = waterMl > 0 ? vialMg / waterMl : 0;
      const mlPerDose = mgPerMl > 0 ? doseMg / mgPerMl : 0;
      const unitsPerMl = calc.syringeVolumeMl > 0 ? calc.syringeSizeUnits / calc.syringeVolumeMl : 0;
      const unitsPerDose = unitsPerMl > 0 ? mlPerDose * unitsPerMl : 0;
      const fillPercent = unitsPerDose > 0 ? Math.min(100, (unitsPerDose / calc.syringeSizeUnits) * 100) : 0;

      const handleChange = (field, value) => {
        setCalc(prev => ({ ...prev, [field]: value }));
      };

      return (
        <div className="tools-grid">
          <div className="tool-card">
            <div className="tool-card-title">Reconstitution Calculator</div>
            <div className="tool-card-subtitle">Dial in mg/mL, mL per dose, and syringe units.</div>
            <div className="tool-grid-2">
              <div className="tool-input">
                <label>Vial amount (mg)</label>
                <input
                  type="number"
                  inputMode="decimal"
                  value={calc.vialAmountMg}
                  onChange={e => handleChange('vialAmountMg', e.target.value)}
                  placeholder="e.g. 10"
                />
              </div>
              <div className="tool-input">
                <label>BAC water (mL)</label>
                <input
                  type="number"
                  inputMode="decimal"
                  value={calc.bacWaterMl}
                  onChange={e => handleChange('bacWaterMl', e.target.value)}
                  placeholder="e.g. 2"
                />
              </div>
              <div className="tool-input">
                <label>Dose amount (mg)</label>
                <input
                  type="number"
                  inputMode="decimal"
                  value={calc.doseAmountMg}
                  onChange={e => handleChange('doseAmountMg', e.target.value)}
                  placeholder="e.g. 0.25"
                />
              </div>
              <div className="tool-input">
                <label>Syringe size / volume</label>
                <input
                  type="number"
                  inputMode="decimal"
                  value={calc.syringeSizeUnits}
                  onChange={e => handleChange('syringeSizeUnits', e.target.value)}
                  placeholder="Units (e.g. 100)"
                />
                <input
                  style={{ marginTop: 4 }}
                  type="number"
                  inputMode="decimal"
                  value={calc.syringeVolumeMl}
                  onChange={e => handleChange('syringeVolumeMl', e.target.value)}
                  placeholder="mL (e.g. 1)"
                />
              </div>
            </div>

            <div className="tool-results">
              <div className="tool-result-line">
                <span className="tool-result-label">Concentration</span>
                <span className="tool-result-value">
                  {mgPerMl ? `${mgPerMl.toFixed(2)} mg/mL` : '--'}
                </span>
              </div>
              <div className="tool-result-line">
                <span className="tool-result-label">mL per dose</span>
                <span className="tool-result-value">
                  {mlPerDose ? `${mlPerDose.toFixed(3)} mL` : '--'}
                </span>
              </div>
              <div className="tool-result-line">
                <span className="tool-result-label">Units per dose</span>
                <span className="tool-result-value">
                  {unitsPerDose ? `${unitsPerDose.toFixed(1)} U` : '--'}
                </span>
              </div>
            </div>

            <div className="syringe-wrapper">
              <div className="syringe">
                <div className="syringe-barrel">
                  <div className="syringe-fill" style={{ height: `${fillPercent}%` }} />
                  {Array.from({ length: 10 }).map((_, i) => (
                    <div key={i} className="syringe-mark" style={{ bottom: `${i * 10}%` }} />
                  ))}
                </div>
              </div>
              <div className="syringe-labels">
                <span className="syringe-label-main">
                  {unitsPerDose ? `${unitsPerDose.toFixed(1)} units` : 'Set dose'}
                </span>
                <span>{mlPerDose ? `${mlPerDose.toFixed(3)} mL in syringe` : ''}</span>
              </div>
            </div>
          </div>
        </div>
      );
    }


    function ScheduleModal({ schedule, onSave, onDelete, onClose }) {
      const [formData, setFormData] = useState({
        name: schedule?.name || '', dosage: schedule?.dosage || '', frequency: schedule?.frequency || 'once/day',
        daysPerWeek: schedule?.daysPerWeek || ['Mon', 'Wed', 'Fri'], timeOfDay: schedule?.timeOfDay || 'morning',
        startDate: schedule?.startDate || '', endDate: schedule?.endDate || '', cycleWeeks: schedule?.cycleWeeks || '', notes: schedule?.notes || ''
      });
      const [showSuggestions, setShowSuggestions] = useState(false);
      
      useEffect(() => {
        const handler = (e) => {
          const p = e.detail;
          setFormData(prev => ({ ...prev, name: p.name, dosage: p.defaultDose, notes: `${p.uses}` }));
        };
        window.addEventListener('prefillPeptide', handler);
        return () => window.removeEventListener('prefillPeptide', handler);
      }, []);
      
      const suggestions = formData.name.length > 1 ? PEPTIDE_DATABASE.filter(p => p.name.toLowerCase().includes(formData.name.toLowerCase())).slice(0, 5) : [];
      
      const selectSuggestion = (p) => {
        setFormData(prev => ({ ...prev, name: p.name, dosage: p.defaultDose }));
        setShowSuggestions(false);
      };
      
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const toggleDay = (day) => setFormData(prev => ({ ...prev, daysPerWeek: prev.daysPerWeek.includes(day) ? prev.daysPerWeek.filter(d => d !== day) : [...prev.daysPerWeek, day] }));
      const handleSubmit = (e) => { e.preventDefault(); onSave({ ...formData, cycleWeeks: formData.cycleWeeks ? parseInt(formData.cycleWeeks) : null }); };
      
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-handle" />
            <div className="modal-header"><h2 className="modal-title">{schedule ? 'Edit Schedule' : 'New Schedule'}</h2><button className="modal-close" onClick={onClose}><Icons.X /></button></div>
            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label className="form-label">Peptide Name</label>
                <input type="text" className="form-input" placeholder="Search or type name..." value={formData.name} onChange={e => { setFormData(prev => ({ ...prev, name: e.target.value })); setShowSuggestions(true); }} onFocus={() => setShowSuggestions(true)} required />
                {showSuggestions && suggestions.length > 0 && (
                  <div className="peptide-suggestions">
                    {suggestions.map(p => (
                      <div key={p.id} className="peptide-suggestion" onClick={() => selectSuggestion(p)}>
                        <div className="peptide-suggestion-name">{p.name}</div>
                        <div className="peptide-suggestion-info">{p.defaultDose} â€¢ {p.frequency}</div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
              <div className="form-row">
                <div className="form-group"><label className="form-label">Dosage</label><input type="text" className="form-input" placeholder="e.g., 500 mcg" value={formData.dosage} onChange={e => setFormData(prev => ({ ...prev, dosage: e.target.value }))} required /></div>
                <div className="form-group"><label className="form-label">Frequency</label><select className="form-input form-select" value={formData.frequency} onChange={e => setFormData(prev => ({ ...prev, frequency: e.target.value }))}><option value="once/day">Once daily</option><option value="twice/day">Twice daily</option><option value="once/week">Once weekly</option><option value="twice/week">Twice weekly</option><option value="as needed">As needed</option></select></div>
              </div>
              <div className="form-group"><label className="form-label">Days of Week</label><div className="day-selector">{days.map(day => <button key={day} type="button" className={`day-chip ${formData.daysPerWeek.includes(day) ? 'selected' : ''}`} onClick={() => toggleDay(day)}>{day}</button>)}</div></div>
              <div className="form-group"><label className="form-label">Time of Day</label><select className="form-input form-select" value={formData.timeOfDay} onChange={e => setFormData(prev => ({ ...prev, timeOfDay: e.target.value }))}><option value="morning">Morning</option><option value="evening">Evening</option><option value="anytime">Anytime</option></select></div>
              <div className="form-row">
                <div className="form-group"><label className="form-label">Start Date</label><input type="date" className="form-input" value={formData.startDate} onChange={e => setFormData(prev => ({ ...prev, startDate: e.target.value }))} /></div>
                <div className="form-group"><label className="form-label">End Date</label><input type="date" className="form-input" value={formData.endDate} onChange={e => setFormData(prev => ({ ...prev, endDate: e.target.value }))} /></div>
              </div>
              <div className="form-group"><label className="form-label">Cycle Length (weeks)</label><input type="number" className="form-input" placeholder="e.g., 12" value={formData.cycleWeeks} onChange={e => setFormData(prev => ({ ...prev, cycleWeeks: e.target.value }))} /></div>
              <div className="form-group"><label className="form-label">Notes</label><input type="text" className="form-input" placeholder="Optional notes..." value={formData.notes} onChange={e => setFormData(prev => ({ ...prev, notes: e.target.value }))} /></div>
              <button type="submit" className="form-submit">{schedule ? 'Save Changes' : 'Add Schedule'}</button>
              {schedule && <button type="button" className="form-delete" onClick={() => { if (confirm('Delete?')) onDelete(schedule.id); }}>Delete Schedule</button>}
            </form>
          </div>
        </div>
      );
    }
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
